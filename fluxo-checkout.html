<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <title>Fluxo de integração e URLs do Checkout Cielo</title>

    <link href="stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
    <link href="https://www.cielo.com.br/wps/contenthandler/!ut/p/digest!3SvhW8ACOLyj_90YHxPhKQ/war/cielo-tema/themes/estatico/images/favicon.ico" rel="shortcut icon" type="image/x-icon" />

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="javascripts/all.js" type="text/javascript"></script>

    <script async src='//www.google-analytics.com/analytics.js'></script>
    <script>
    window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;

    ga('create', 'UA-8516386-7', {'cookieDomain': 'auto',
    'alwaysSendReferrer': true});

    ga("set", "transport", "beacon");
    ga('send', 'pageview');
    </script>
</head>

<body class="fluxo-checkout">
    <a href="#" id="nav-button">
        <span>
            NAV
            <img src="images/navbar.png" />
        </span>
    </a>
    <div class="tocify-wrapper">
        <ul class="languages">
            <li class="english"><a href="english.html" title="English version">English version</a></li>
            <li class="portuguese"><a href="index.html" title="Versão em português">Versão em português</a></li>
        </ul>
        <img src="images/logo.png" />
        <div class="search">
            <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
        <div id="toc">
        </div>
        <h2 class="toc-footer-title">Materiais complementares</h2>
        <ul class="toc-footer">
            <li><a href='/Checkout-Backoffice/'>Backoffice Cielo</a></li>
            <li><a href='/Checkout-FAQ/'>Perguntas Frequêntes</a></li>
        </ul>
        <div class="links-footer">
            <ul class="link-list">
                <li class="cielo"><a href="https://www.cielo.com.br/ecommerce">Cielo</a></li>
                <li class="github"><a href="https://github.com/developercielo">Cielo</a></li>
                <li class="desenvolvedores"><a href="https://www.cielo.com.br/desenvolvedores">Cielo</a></li>
            </ul>
        </div>
    </div>
    <div class="page-wrapper">
            <div class="content no-dark-box">
                <h1 id="fluxo-de-integração">Fluxo de integração</h1>

<p>O Checkout Cielo utiliza uma tecnologia REST que deve ser usada quando houver um “carrinho de compras” a ser enviado, ou seja, no caso do consumidor navegar pelo site e escolher 1 ou mais produtos para adicionar ao carrinho e depois, então, finalizar a compra. Há também opção de integração via botão usada sempre que não houver um “carrinho de compras” em sua loja ou quando se deseja associar uma compra rápida direta a um produto.</p>

<p>Durante a integração com o Checkout Cielo, alguns passos e alguns redirecionamentos ocorrerão. A imagem abaixo ilustra esse fluxo:</p>

<p><img alt="Fluxo de integração Checkout Cielo" src="images/fluxo-checkout.svg" /></p>

<p>Após o cliente escolher seu(s) produto(s), ele entrará no fluxo de finalização da compra.</p>

<ol>
<li>O cliente decide pagar.</li>
<li>A loja faz a integração com o Checkout Cielo</li>
<li>A API da Cielo returna o CheckoutURL que deverá ser utilizado pela loja para redirecionar o cliente para o ambiente seguro de pagamento.</li>
<li>A loja redireciona o cliente para a URL retornada pela Cielo</li>
<li>O cliente faz o pagamento</li>
<li>A Cielo redireciona o cliente para a URL de Retorno, configurada no Backoffice Cielo.</li>
<li>A loja avisa ao cliente que o processo foi concluído e que ele receberá mais informações sobre a compra e o pagamento por email.</li>
<li>A Cielo envia o POST de notificação para a URL de Notificação, configurada no Backoffice Cielo.</li>
<li>A loja processa o pedido utilizando os dados do POST de notificação e, se a transação estiver autorizada, libera o pedido.</li>
</ol>

<h1 id="urls-do-checkout-cielo">URLs do Checkout Cielo</h1>

<p>A loja configura três URLs em seu Backoffice:</p>

<p><img alt="Configurações da loja" src="images/checkout-configuracoes-loja.png" /></p>

<ul>
<li><strong>URL de Retorno</strong> – Ao finalizar uma transação, o comprador final poderá ser redirecionado para a URL de retorno. Ao clicar no botão “VOLTAR” na tela de comprovante de vendas, o comprador será direcionando para a URL de retorno previamente cadastrada no BackOffice.</li>
<li><strong>URL de Notificação</strong> – Ao finalizar uma transação é enviado um post com todos os dados da venda para a URL de Notificação cadastrada, previamente cadastrada no BackOffice.</li>
<li><strong>URL de Mudança de Status</strong> – Quando um pedido tiver seu status alterado, será enviando um post para a URL de Mudança de Status, previamente cadastrada no BackOffice.</li>
</ul>

<h2 id="url-de-retorno">URL de Retorno</h2>

<p>A URL de Retorno é a que a Cielo utilizará para redirecionar o cliente de volta para a loja assim que o pagamento for concluído. Essa página da loja deverá estar preparada para receber o cliente ao fim do fluxo e avisá-lo que o processo foi concluído e que ele receberá mais informações em breve.</p>

<h2 id="url-de-notificação">URL de Notificação</h2>

<p>A URL de Notificação é a que a Cielo utilizará para enviar os dados da transação, do carrinho e da autorização ao fim do fluxo de integração. Ao receber a notificação, a loja terá todas as informações sobre o carrinho, pedido e poderá utilizar essas informações para alimentar seu sistema.</p>

<h3 id="parâmetros-para-integração-com-post-de-notificação">Parâmetros para integração com POST de notificação</h3>

<table><thead>
<tr>
<th>Parâmetro</th>
<th>Descrição</th>
<th>Tipo do campo</th>
<th>Tamanho mínimo</th>
<th>Tamanho máximo</th>
</tr>
</thead><tbody>
<tr>
<td>checkout_cielo_order_number</td>
<td>Identificador único gerado pelo CHECKOUT CIELO</td>
<td>Alfanumérico</td>
<td>1</td>
<td>32</td>
</tr>
<tr>
<td>amount</td>
<td>Preço unitário do produto, em centavos (ex: R$ 1,00 = 100)</td>
<td>Numérico</td>
<td>1</td>
<td>10</td>
</tr>
<tr>
<td>order_number</td>
<td>Número do pedido enviado pela loja</td>
<td>Alfanumérico</td>
<td>1</td>
<td>32</td>
</tr>
<tr>
<td>created_date</td>
<td>Data da criação do pedido (dd/MM/yyyy HH:mm:ss)</td>
<td>Alfanumérico</td>
<td>1</td>
<td>20</td>
</tr>
<tr>
<td>customer_name</td>
<td>Nome do consumidor. Se enviado, esse valor já vem preenchido na tela do CHECKOUT CIELO</td>
<td>Alfanumérico</td>
<td>1</td>
<td>289</td>
</tr>
<tr>
<td>customer_identity</td>
<td>Identificação do consumidor (CPF ou CNPJ) Se enviado, esse valor já vem preenchido na tela do CHECKOUT CIELO</td>
<td>Alfanumérico</td>
<td>1</td>
<td>14</td>
</tr>
<tr>
<td>customer_email</td>
<td>E-mail do consumidor. Se enviado, esse valor já vem preenchido na tela do CHECKOUT CIELO</td>
<td>Alfanumérico</td>
<td>1</td>
<td>64</td>
</tr>
<tr>
<td>customer_phone</td>
<td>Telefone do consumidor. Se enviado, esse valor já vem preenchido na tela do CHECKOUT CIELO</td>
<td>Numérico</td>
<td>1</td>
<td>11</td>
</tr>
<tr>
<td>discount_amount</td>
<td>Valor do desconto fornecido (enviado somente se houver desconto)</td>
<td>Numérico</td>
<td>1</td>
<td>10</td>
</tr>
<tr>
<td>shipping_type</td>
<td>Modalidade de frete</td>
<td>Numérico</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>shipping_name</td>
<td>Nome do frete</td>
<td>Alfanumérico</td>
<td>1</td>
<td>128</td>
</tr>
<tr>
<td>shipping_price</td>
<td>Valor do serviço de frete, em centavos (ex: R$ 10,00 = 1000)</td>
<td>Numérico</td>
<td>1</td>
<td>10</td>
</tr>
<tr>
<td>shipping_address_zipcode</td>
<td>CEP do endereço de entrega</td>
<td>Numérico</td>
<td>1</td>
<td>8</td>
</tr>
<tr>
<td>shipping_address_district</td>
<td>Bairro do endereço de entrega</td>
<td>Texto</td>
<td>1</td>
<td>64</td>
</tr>
<tr>
<td>shipping_address_city</td>
<td>Cidade do endereço de entrega</td>
<td>Alfanumérico</td>
<td>1</td>
<td>64</td>
</tr>
<tr>
<td>shipping_address_state</td>
<td>Estado de endereço de entrega</td>
<td>Alfanumérico</td>
<td>1</td>
<td>64</td>
</tr>
<tr>
<td>shipping_address_line1</td>
<td>Endereço de entrega</td>
<td>Alfanumérico</td>
<td>1</td>
<td>256</td>
</tr>
<tr>
<td>shipping_address_line2</td>
<td>Complemento do endereço de entrega</td>
<td>Alfanumérico</td>
<td>1</td>
<td>256</td>
</tr>
<tr>
<td>shipping_address_number</td>
<td>Número do endereço de entrega</td>
<td>Numérico</td>
<td>1</td>
<td>8</td>
</tr>
<tr>
<td>payment_method_type</td>
<td>Cód. do tipo de meio de pagamento</td>
<td>Numérico</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>payment_method_brand</td>
<td>Bandeira (somente para transações com meio de pagamento cartão de crédito)</td>
<td>Numérico</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>payment_method_bank</td>
<td>Banco emissor (Para transações de Boleto e Débito Automático)</td>
<td></td>
<td>Numérico</td>
<td>1</td>
</tr>
<tr>
<td>payment_maskedcredicard</td>
<td>Cartão Mascarado (Somente para transações com meio de pagamento cartão de crédito)</td>
<td>Alfanumérico</td>
<td>1</td>
<td>20</td>
</tr>
<tr>
<td>payment_installments</td>
<td>Número de parcelas</td>
<td>Numérico</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>payment_antifrauderesult</td>
<td>Status das transações de cartão de Crédito no Antifraude</td>
<td></td>
<td>Numérico</td>
<td>1</td>
</tr>
<tr>
<td>payment_boletonumber</td>
<td>Numero do boleto gerado</td>
<td>String</td>
<td></td>
<td></td>
</tr>
<tr>
<td>payment_boletoexpirationdate</td>
<td>Data de vencimento para transações realizadas com boleto bancário</td>
<td>Numérico</td>
<td>1</td>
<td>10</td>
</tr>
<tr>
<td>payment_status</td>
<td>Status da transação</td>
<td>Numérico</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>tid</td>
<td>TID Cielo gerado no momento da autorização da transação</td>
<td>Alfanumérico</td>
<td>1</td>
<td>32</td>
</tr>
</tbody></table>

<aside class="notice">A página destino do POST de Notificação deve seguir a formatação dos parâmetros com todos os nomes em MINUSCULO</aside>

<h3 id="recebimento-do-post-de-notificação">Recebimento do POST de notificação</h3>

<ul>
<li>Quando acessada pelo servidor da Braspag, enviando o POST da tabela acima, a URL cadastrada para Notificação deverá exibir um código informando que recebeu a mudança de status e a processou com sucesso. <strong>Código:</strong><code class="prettyprint">&lt;status&gt;OK&lt;/status&gt;</code></li>
<li>Se a URL for acessada pelo nosso servidor e não exibir o código de confirmação, o servidor irá tentar novamente por três vezes, a cada hora. Caso o <code class="prettyprint">&lt;status&gt;OK&lt;/status&gt;</code> ainda não seja exibido, será entendido que o servidor da loja não responde.</li>
<li>A URL de Notificação somente pode utilizar <strong>porta 80</strong> (padrão para http) ou <strong>porta 443</strong> (padrão para https).</li>
</ul>

<h2 id="url-de-mudança-de-status">URL de Mudança de Status</h2>

<p>A URL de Mudança de Status é a que a Cielo utilizará para notificar a loja sobre as mudanças de status das transações. Uma mudança de status, de Autorizado para Cancelado, por exemplo, pode ocorrer a qualquer momento. Se o administrador da loja cancelar um pedido no Backoffice Cielo, então a Cielo enviará para a URL de Mudança de Status uma notificação semelhante a enviada para a URL de notificação. A única diferença dessa notificação é que não conterá os dados do carrinho, mas apenas do pedido e o novo status da autorização.</p>

<aside class="warning">A URL de mudança de status é fornecida pelo lojista. Nessa URL serão postadas as informações de todos os pedidos que tiverem seu status alterado.</aside>

<h3 id="parâmetros-para-integração-com-post-de-mudança-de-status">Parâmetros para integração com POST de Mudança de Status</h3>

<table><thead>
<tr>
<th>Parâmetro</th>
<th>Descrição</th>
<th>Tipo do campo</th>
<th>Tamanho mínimo</th>
<th>Tamanho máximo</th>
</tr>
</thead><tbody>
<tr>
<td>checkout_cielo_order_number</td>
<td>Identificador único gerado pelo CHECKOUT CIELO.</td>
<td>Alfanumérico</td>
<td>1</td>
<td>32</td>
</tr>
<tr>
<td>amount</td>
<td>Preço unitário do produto, em centavos (ex: R$ 1,00 = 100)</td>
<td>Numérico</td>
<td>1</td>
<td>10</td>
</tr>
<tr>
<td>order_number</td>
<td>Número do pedido enviado pela loja</td>
<td>Alfanumérico</td>
<td>1</td>
<td>32</td>
</tr>
<tr>
<td>payment_status</td>
<td>Status da transação</td>
<td>Numérico</td>
<td>1</td>
<td>1</td>
</tr>
</tbody></table>

<h3 id="recebimento-do-post-de-mudança-de-status">Recebimento do POST de Mudança de Status</h3>

<ul>
<li>Quando acessada pelo servidor da Braspag, enviando o POST, a URL cadastrada para Retorno de Mudança de Status, deverá exibir um código informando que recebeu a mudança de status e a processou com sucesso: <code class="prettyprint">&lt;status&gt;OK&lt;/status&gt;</code></li>
<li>Se a URL de mudança de status da loja for acessada pelo servidor da Braspag não exibir o código de confirmação, o servidor irá tentar novamente por três vezes.</li>
<li>Caso o <code class="prettyprint">&lt;status&gt;OK&lt;/status&gt;</code> ainda não seja exibido, será entendido que o servidor da loja não responde, e será enviado um e-mail ao responsável pela loja, informando que o pedido em questão foi pago.</li>
<li>Ou seja, o código fonte da página indicando Sucesso deverá conter APENAS <code class="prettyprint">&lt;status&gt;OK&lt;/status&gt;</code> <strong>e nada mais</strong>.</li>
</ul>

<aside class="notice">Na tela de pedidos, dentro de cada transação, há a opção de reenvio do POST de mudança de status. Basta clicar nos botões azuis, marcados na imagem abaixo</aside>

<p><img alt="Reenvio de notificação" src="images/checkout-reenviar-notificacao.png" /></p>

            </div>
        </div>
    </body>
    </html>
